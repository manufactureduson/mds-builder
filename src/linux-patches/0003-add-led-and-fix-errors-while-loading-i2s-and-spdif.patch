From 266668a9d2c86d6300ed4158ef40a865196c0732 Mon Sep 17 00:00:00 2001
From: Nicolas Aguirre <aguirre.nicolas@gmail.com>
Date: Sun, 28 Jan 2024 09:52:33 +0100
Subject: [PATCH 3/5] add led and fix errors while loading i2s and spdif

---
 .../arm/boot/dts/allwinner/suniv-f1c100s.dtsi |  6 +--
 ...univ-f1c200s-mds-network-streamer-v1.0.dts | 47 ++++++++++++-------
 2 files changed, 32 insertions(+), 21 deletions(-)

diff --git a/arch/arm/boot/dts/allwinner/suniv-f1c100s.dtsi b/arch/arm/boot/dts/allwinner/suniv-f1c100s.dtsi
index 664deccb579a..61bfdd337909 100644
--- a/arch/arm/boot/dts/allwinner/suniv-f1c100s.dtsi
+++ b/arch/arm/boot/dts/allwinner/suniv-f1c100s.dtsi
@@ -82,8 +82,8 @@ i2s0: i2s@1c22000 {
 			compatible = "allwinner,sun4i-a10-i2s";
 			reg = <0x01c22400 0x400>;
 			interrupts = <35>;
-			clocks = <&ccu CLK_BUS_I2S0>, <&ccu CLK_I2S>;
-			clock-names = "apb", "i2s";
+			clocks = <&ccu CLK_BUS_I2S0>, <&ccu CLK_BUS_I2S0>, <&ccu CLK_I2S>;
+			clock-names = "apb", "mod", "i2s";
 			dmas = <&dma SUN4I_DMA_NORMAL 3>,
 			       <&dma SUN4I_DMA_NORMAL 3>;
 			dma-names = "rx", "tx";
@@ -95,7 +95,7 @@ spdif: spdif@1c21400 {
 			compatible = "allwinner,sun4i-a10-spdif";
 			reg = <0x01c21400 0x400>;
 			interrupts = <5>;
-			clocks = <&ccu CLK_SPDIF>;
+			clocks = <&ccu CLK_BUS_SPDIF>, <&ccu CLK_SPDIF>;
 			clock-names = "apb", "spdif";
 			dmas = <&dma SUN4I_DMA_NORMAL 2>,
 			       <&dma SUN4I_DMA_NORMAL 2>;
diff --git a/arch/arm/boot/dts/allwinner/suniv-f1c200s-mds-network-streamer-v1.0.dts b/arch/arm/boot/dts/allwinner/suniv-f1c200s-mds-network-streamer-v1.0.dts
index 7127742934d7..5041deb3d743 100644
--- a/arch/arm/boot/dts/allwinner/suniv-f1c200s-mds-network-streamer-v1.0.dts
+++ b/arch/arm/boot/dts/allwinner/suniv-f1c200s-mds-network-streamer-v1.0.dts
@@ -22,16 +22,16 @@ chosen {
 		stdout-path = "serial0:115200n8";
 	};
 
-	// leds {
-	// 	compatible = "gpio-leds";
-
-	// 	led {
-	// 		function = LED_FUNCTION_STATUS;
-	// 		color = <LED_COLOR_ID_GREEN>;
-	// 		gpios = <&pio 4 6 GPIO_ACTIVE_HIGH>; /* PE6 */
-	// 		linux,default-trigger = "heartbeat";
-	// 	};
-	// };
+	leds {
+		compatible = "gpio-leds";
+
+		led {
+			function = LED_FUNCTION_STATUS;
+			color = <LED_COLOR_ID_GREEN>;
+			gpios = <&pio 4 6 GPIO_ACTIVE_HIGH>; /* PE6 */
+			linux,default-trigger = "heartbeat";
+		};
+	};
 
 	reg_vcc3v3: regulator-3v3 {
 		compatible = "regulator-fixed";
@@ -78,13 +78,7 @@ simple-audio-card,codec {
 	};
 };
 
-// &mmc0 {
-// 	cd-gpios = <&pio 4 3 GPIO_ACTIVE_LOW>; /* PE3 */
-// 	bus-width = <4>;
-// 	disable-wp;
-// 	vmmc-supply = <&reg_vcc3v3>;
-// 	status = "okay";
-// };
+
 
 &otg_sram {
 	status = "okay";
@@ -96,9 +90,26 @@ &spi0 {
 	status = "okay";
 
 	flash@0 {
-		compatible = "spi-nand";
+		#address-cells = <1>;
+		#size-cells = <1>;
+		compatible = "winbond,w25q128", "spi-nand";
 		reg = <0>;
 		spi-max-frequency = <40000000>;
+		partitions {
+			compatible = "fixed-partitions";
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			partition@0 {
+				label = "boot";
+				reg = <0 0x100000>;
+			};
+
+			partition@100000 {
+				label = "rootfs";
+				reg = <0x100000 0x7F00000>;
+			};
+		};
 	};
 };
 
-- 
2.39.2

